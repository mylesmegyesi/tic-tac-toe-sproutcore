Tictactoe=SC.Application.create({NAMESPACE:"Tictactoe"});if(typeof CHANCE_SLICES==="undefined"){var CHANCE_SLICES=[]}CHANCE_SLICES=CHANCE_SLICES.concat([]);Tictactoe.PlayerSymbols={User:"X",Computer:"O"};Tictactoe.GameState={Playing:0,UserWon:1,ComputerWon:2,Draw:3};sc_require("models/game_state");Tictactoe.GameHelper=SC.Object.extend({gameState:function(a){if(this.checkIfPlayerWon(a,Tictactoe.PlayerSymbols.User)){return Tictactoe.GameState.UserWon}else{if(this.checkIfPlayerWon(a,Tictactoe.PlayerSymbols.Computer)){return Tictactoe.GameState.ComputerWon}else{if(this.boardIsFull(a)){return Tictactoe.GameState.Draw}}}return Tictactoe.GameState.Playing},checkIfPlayerWon:function(a,b){return((a[0]==b&&a[1]==b&&a[2]==b)||(a[3]==b&&a[4]==b&&a[5]==b)||(a[6]==b&&a[7]==b&&a[8]==b)||(a[0]==b&&a[3]==b&&a[6]==b)||(a[1]==b&&a[4]==b&&a[7]==b)||(a[2]==b&&a[5]==b&&a[8]==b)||(a[0]==b&&a[4]==b&&a[8]==b)||(a[2]==b&&a[4]==b&&a[6]==b))},boardIsFull:function(b){for(var a=0;a<9;a++){if(b[a]===null){return false}}return true}});sc_require("helpers/game_helper");Tictactoe.Computer=SC.Object.extend({helper:Tictactoe.GameHelper.create(),getNextMove:function(d){var a=-2;var c;var e;for(var b=0;b<9;b++){if(d[b]!==null){continue}e=d.slice(0);e[b]=Tictactoe.PlayerSymbols.Computer;var f=-this.negamax(e,Tictactoe.PlayerSymbols.User,-1000,1000);if(f>a){a=f;c=b}}return c},negamax:function(d,b,g,f){var c=this.helper.gameState(d);if(c!=Tictactoe.GameState.Playing){switch(c){case Tictactoe.GameState.UserWon:return(b==Tictactoe.PlayerSymbols.User)?1000:-1000;case Tictactoe.GameState.ComputerWon:return(b==Tictactoe.PlayerSymbols.Computer)?1000:-1000;default:return 0}}var e;for(var a=0;a<9;a++){if(d[a]!==null){continue}var h;e=d.slice(0);if(b==Tictactoe.PlayerSymbols.User){e[a]=Tictactoe.PlayerSymbols.User;h=-this.negamax(e,Tictactoe.PlayerSymbols.Computer,-f,-g)}else{if(b==Tictactoe.PlayerSymbols.Computer){e[a]=Tictactoe.PlayerSymbols.Computer;h=-this.negamax(e,Tictactoe.PlayerSymbols.User,-f,-g)}}g=Math.max(g,h);if(g>=f){break}}return g+1}});Tictactoe.Square=SC.Object.extend({value:null});sc_require("models/square_model");Tictactoe.Board=SC.Object.extend({init:function(){arguments.callee.base.apply(this,arguments);this._array=[];for(var a=0;a<9;a++){this._array.pushObject(Tictactoe.Square.create())}this.toggleBoardObservers()},boardObserversOn:true,moveCount:0,toggleBoardObservers:function(){if(this.get("boardObserversOn")){this.turnOnObservers()}else{this.turnOffObservers()}}.observes("boardObserversOn"),turnOnObservers:function(){for(var a=0;a<9;a++){this._array[a].addObserver("value",this,this.boardChanged)}},turnOffObservers:function(){for(var a=0;a<9;a++){this._array[a].removeObserver("value",this,this.boardChanged)}},boardChanged:function(){this.set("moveCount",this.get("moveCount")+1)},setIndex:function(a,b){this._array[a].set("value",b)},getIndex:function(a){return this._array[a].get("value")},squares:function(){return this._array}.property(),values:function(){var a=[];for(var b=0;b<9;b++){a[b]=this.getIndex(b)}return a}.property(),copy:function(){var a=this.copyWithoutObservers();a.set("boardObserversOn",true);return a},copyWithoutObservers:function(){var b=Tictactoe.Board.create({boardObserversOn:false});for(var a=0;a<9;a++){b.setIndex(a,this._array[a].get("value"))}return b},reset:function(){var b=this.get("boardObserversOn");if(b){this.turnOffObservers()}for(var a=0;a<9;a++){this.setIndex(a,null)}this.set("moveCount",0);if(b){this.turnOnObservers()}}});sc_require("models/player_symbols");sc_require("models/computer_model");sc_require("models/square_model");sc_require("models/board_model");sc_require("models/game_state");sc_require("helpers/game_helper");Tictactoe.GameController=SC.ObjectController.create({board:Tictactoe.Board.create(),computer:Tictactoe.Computer.create(),gameHelper:Tictactoe.GameHelper.create(),isUsersTurn:function(){var a=this.board.get("moveCount");return(a%2)===0}.property("board.moveCount").cacheable(),gameState:function(){return this.gameHelper.gameState(this.board.get("values"))}.property("isUsersTurn").cacheable(),userMove:function(d){var b=d.get("value");var c=this.get("isUsersTurn");var a=this.get("gameState")!=Tictactoe.GameState.Playing;if(d.get("value")!==null||!this.get("isUsersTurn")||this.get("gameState")!=Tictactoe.GameState.Playing){return}d.set("value",Tictactoe.PlayerSymbols.User)},computerMove:function(){if(this.get("isUsersTurn")||this.get("gameState")!=Tictactoe.GameState.Playing){return}this.board.setIndex(this.computer.getNextMove(this.board.get("values")),Tictactoe.PlayerSymbols.Computer)}.observes("isUsersTurn")});Tictactoe.Theme=SC.AceTheme.create({name:"tictactoe"});SC.Theme.addTheme(Tictactoe.Theme);SC.defaultTheme="tictactoe";Tictactoe.SquareView=SC.LabelView.extend({classNames:["squareView"],click:function(){Tictactoe.GameController.userMove(this.get("content"))},value:function(){var a=this.get("content").value;return(a?a:"")}.property("content.value").cacheable()});sc_require("views/square_view");Tictactoe.BoardView=SC.GridView.extend({classNames:["boardView"],isSelectable:false,columnWidth:100,rowHeight:100,layout:{centerX:0,centerY:0,width:325,height:300},exampleView:Tictactoe.SquareView,contentBinding:"Tictactoe.GameController.board.squares"});Tictactoe.mainPage=SC.Page.design({mainPane:SC.MainPane.design({childViews:"boardView".w(),boardView:Tictactoe.BoardView.create()})});Tictactoe.main=function main(){Tictactoe.getPath("mainPage.mainPane").append()};function main(){Tictactoe.main()};